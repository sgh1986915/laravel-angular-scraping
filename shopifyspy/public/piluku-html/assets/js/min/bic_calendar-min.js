$.fn.bic_calendar=function(a){var e=$.extend({},$.fn.bic_calendar.defaults,a);return this.each(function(){function a(){f=$('<table class="diasmes table">'),r();var a=new Date,e=x.val();if(""!=e&&l(e)){var o=e.split("/");2==o[2].length&&("0"==o[2].charAt(0)&&(o[2]=o[2].substring(1)),o[2]=parseInt(o[2]),o[2]<50&&(o[2]+=2e3)),a=new Date(o[2],o[1]-1,o[0])}var i=a.getMonth(),p=a.getFullYear();n(i,p);var d=$('<a href="#"><i class="fa fa-angle-right"></i></a>');d.click(function(a){a.preventDefault(),i=(i+1)%12,0==i&&p++,t(i,p)});var u=$('<a href="#"><i class="fa fa-angle-left"></i> </a>');u.click(function(a){a.preventDefault(),i-=1,-1==i&&(p--,i=11),t(i,p)});var g=$('<div class="calendar-head "></div>'),m=$('<h4 class="text-center"></h4>');g.append(u),g.append(m),g.append(d),m.append(v),c=$('<div class="bic_calendar" id="'+_+'" ></div>'),c.prepend(g),c.append(f),x.append(c),s(i,p)}function t(a,e){f.empty(),r(),n(a,e),s(a,e)}function r(){if(0!=h){var a=$('<tr class="dias_semana" >'),e="";$(g).each(function(a,t){e+="<td",0==a&&(e+=' class="primero"'),6==a&&(e+=' class="domingo ultimo"'),e+=">"+t+"</td>"}),e+="</tr>",a.append(e),f.append(a)}}function n(a,e){v.text(m[a]+" "+e);for(var t=1,r=o(1,a,e),n=p(a,e),i=a+1,l="",s=0;7>s;s++){if(r>s){var d="";0==s&&(d+="<tr>"),d+='<td class="diainvalido',0==s&&(d+=" primero"),d+='"></td>'}else{var d="";0==s&&(d+="<tr>"),d+='<td id="'+_+"_"+t+"_"+i+"_"+e+'" ',0==s&&(d+=' class="primero"'),6==s&&(d+=' class="ultimo domingo"'),d+="><a>"+t+"</a></span>",6==s&&(d+="</tr>"),t++}l+=d}for(var c=1;n>=t;){var d="";c%7==1&&(d+="<tr>"),d+='<td id="'+_+"_"+t+"_"+i+"_"+e+'" ',c%7==1&&(d+=' class="primero"'),c%7==0&&(d+=' class="domingo ultimo"'),d+="><a>"+t+"</a></td>",c%7==0&&(d+="</tr>"),t++,c++,l+=d}if(c--,c%7!=0){d="";for(var s=c%7+1;7>=s;s++){var d="";d+='<td class="diainvalido',7==s&&(d+=" ultimo"),d+='"></td>',7==s&&(d+="</tr>"),l+=d}}f.append(l)}function o(a,e,t){var r=new Date(t,e,a),n=r.getDay();return 0==n?n=6:n--,n}function i(a,e,t){return a>0&&13>a&&t>0&&32768>t&&e>0&&e<=new Date(t,a,0).getDate()}function p(a,e){for(var t=28;i(a+1,t+1,e);)t++;return t}function l(a){var e=a.split("/");return 3!=e.length?!1:i(e[1],e[0],e[2])}function s(a,e){0!=D?$.ajax({type:D.type,url:D.url,data:{mes:a+1,ano:e},dataType:"json"}).done(function(t){u=[],$.each(t,function(a,e){u.push(t[a])}),d(a,e)}):d(a,e)}function d(a,e){for(var t=a+1,r=0;r<u.length;r++)u[r][0].split("/")[1]==t&&u[r][0].split("/")[2]==e&&($("#"+_+"_"+u[r][0].replace(/\//g,"_")).addClass("event"),$("#"+_+"_"+u[r][0].replace(/\//g,"_")+" a").attr("data-original-title",u[r][1]),u[r][3]&&$("#"+_+"_"+u[r][0].replace(/\//g,"_")).css("background",u[r][3]),""==u[r][2]||"#"==u[r][2]?""!=u[r][4]?($("#"+_+"_"+u[r][0].replace(/\//g,"_")+" a").attr("data-trigger","manual"),$("#"+_+"_"+u[r][0].replace(/\//g,"_")+" a").addClass("manual_popover")):$("#"+_+"_"+u[r][0].replace(/\//g,"_")+" a").attr("href","javascript:false;"):$("#"+_+"_"+u[r][0].replace(/\//g,"_")+" a").attr("href",u[r][2]),u[r][4]?($("#"+_+"_"+u[r][0].replace(/\//g,"_")).addClass("event_popover"),$("#"+_+"_"+u[r][0].replace(/\//g,"_")+" a").attr("rel","popover"),$("#"+_+"_"+u[r][0].replace(/\//g,"_")+" a").attr("data-content",u[r][4])):($("#"+_+"_"+u[r][0].replace(/\//g,"_")).addClass("event_tooltip"),$("#"+_+"_"+u[r][0].replace(/\//g,"_")+" a").attr("rel","tooltip")));$("#"+_+" .event_tooltip a").tooltip(y),$("#"+_+" .event_popover a").popover(b),$(".manual_popover").click(function(){$(this).popover("toggle")})}var c,f,v=$("<span></span>"),_="bic_cal_"+Math.floor(99999*Math.random()).toString(36),u=e.events,g;g="undefined"!=typeof e.dias?e.dias:["l","m","x","j","v","s","d"];var m;m="undefined"!=typeof e.nombresMes?e.nombresMes:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];var h;h="undefined"!=typeof e.show_days?e.show_days:!0;var b;b="undefined"!=typeof e.popover_options?e.popover_options:{placement:"top"};var y;y="undefined"!=typeof e.tooltip_options?e.tooltip_options:{placement:"top"};var D;D="undefined"!=typeof e.req_ajax?e.req_ajax:!1;var x=$(this);a()}),this};
nv.models.pie=function(){"use strict";function t(i){return i.each(function(t){function i(t){t.endAngle=isNaN(t.endAngle)?0:t.endAngle,t.startAngle=isNaN(t.startAngle)?0:t.startAngle,p||(t.innerRadius=0);var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return L(e(t))}}var s=n-e.left-e.right,x=r-e.top-e.bottom,R=Math.min(s,x)/2,k=R-R/5,M=d3.select(this),P=M.selectAll(".nv-wrap.nv-pie").data(t),C=P.enter().append("g").attr("class","nvd3 nv-wrap nv-pie nv-chart-"+u),I=C.append("g"),w=P.select("g");I.append("g").attr("class","nv-pie"),P.attr("transform","translate("+e.left+","+e.top+")"),w.select(".nv-pie").attr("transform","translate("+s/2+","+x/2+")"),M.on("click",function(t,e){y.chartClick({data:t,index:e,pos:d3.event,id:u})});var L=d3.svg.arc().outerRadius(k);m&&L.startAngle(m),b&&L.endAngle(b),p&&L.innerRadius(R*A);var N=d3.layout.pie().sort(null).value(function(t){return t.disabled?0:l(t)}),T=P.select(".nv-pie").selectAll(".nv-slice").data(N);T.exit().remove();var _=T.enter().append("g").attr("class","nv-slice").on("mouseover",function(t,e){d3.select(this).classed("hover",!0),y.elementMouseover({label:a(t.data),value:l(t.data),point:t.data,pointIndex:e,pos:[d3.event.pageX,d3.event.pageY],id:u})}).on("mouseout",function(t,e){d3.select(this).classed("hover",!1),y.elementMouseout({label:a(t.data),value:l(t.data),point:t.data,index:e,id:u})}).on("click",function(t,e){y.elementClick({label:a(t.data),value:l(t.data),point:t.data,index:e,pos:d3.event,id:u}),d3.event.stopPropagation()}).on("dblclick",function(t,e){y.elementDblClick({label:a(t.data),value:l(t.data),point:t.data,index:e,pos:d3.event,id:u}),d3.event.stopPropagation()});if(T.attr("fill",function(t,e){return o(t,e)}).attr("stroke",function(t,e){return o(t,e)}),_.append("path").each(function(t){this._current=t}),d3.transition(T.select("path")).attr("d",L).attrTween("d",i),d){var B=d3.svg.arc().innerRadius(0);c&&(B=L),g&&(B=d3.svg.arc().outerRadius(L.outerRadius())),_.append("g").classed("nv-label",!0).each(function(t){var e=d3.select(this);e.attr("transform",function(t){if(v){t.outerRadius=k+10,t.innerRadius=k+15;var e=(t.startAngle+t.endAngle)/2*(180/Math.PI);return(t.startAngle+t.endAngle)/2<Math.PI?e-=90:e+=90,"translate("+B.centroid(t)+") rotate("+e+")"}return t.outerRadius=R+10,t.innerRadius=R+15,"translate("+B.centroid(t)+")"}),e.append("rect").style("stroke","#fff").style("fill","#fff").attr("rx",3).attr("ry",3),e.append("text").style("text-anchor",v?(t.startAngle+t.endAngle)/2<Math.PI?"start":"end":"middle").style("fill","#000")}),T.select(".nv-label").transition().attr("transform",function(t){if(v){t.outerRadius=k+10,t.innerRadius=k+15;var e=(t.startAngle+t.endAngle)/2*(180/Math.PI);return(t.startAngle+t.endAngle)/2<Math.PI?e-=90:e+=90,"translate("+B.centroid(t)+") rotate("+e+")"}return t.outerRadius=R+10,t.innerRadius=R+15,"translate("+B.centroid(t)+")"}),T.each(function(t){var e=d3.select(this);e.select(".nv-label text").style("text-anchor",v?(t.startAngle+t.endAngle)/2<Math.PI?"start":"end":"middle").text(function(t){var e=(t.endAngle-t.startAngle)/(2*Math.PI),n={key:a(t.data),value:l(t.data),percent:d3.format("%")(e)};return t.value&&e>h?n[f]:""});var n=e.select("text").node().getBBox();e.select(".nv-label rect").attr("width",n.width+10).attr("height",n.height+10).attr("transform",function(){return"translate("+[n.x-5,n.y-5]+")"})})}}),t}var e={top:0,right:0,bottom:0,left:0},n=500,r=500,a=function(t){return t.x},l=function(t){return t.y},i=function(t){return t.description},u=Math.floor(1e4*Math.random()),o=nv.utils.defaultColor(),s=d3.format(",.2f"),d=!0,c=!0,g=!1,f="key",h=.02,p=!1,v=!1,m=!1,b=!1,A=.5,y=d3.dispatch("chartClick","elementClick","elementDblClick","elementMouseover","elementMouseout");return t.dispatch=y,t.options=nv.utils.optionsFunc.bind(t),t.margin=function(n){return arguments.length?(e.top="undefined"!=typeof n.top?n.top:e.top,e.right="undefined"!=typeof n.right?n.right:e.right,e.bottom="undefined"!=typeof n.bottom?n.bottom:e.bottom,e.left="undefined"!=typeof n.left?n.left:e.left,t):e},t.width=function(e){return arguments.length?(n=e,t):n},t.height=function(e){return arguments.length?(r=e,t):r},t.values=function(){return nv.log("pie.values() is no longer supported."),t},t.x=function(e){return arguments.length?(a=e,t):a},t.y=function(e){return arguments.length?(l=d3.functor(e),t):l},t.description=function(e){return arguments.length?(i=e,t):i},t.showLabels=function(e){return arguments.length?(d=e,t):d},t.labelSunbeamLayout=function(e){return arguments.length?(v=e,t):v},t.donutLabelsOutside=function(e){return arguments.length?(g=e,t):g},t.pieLabelsOutside=function(e){return arguments.length?(c=e,t):c},t.labelType=function(e){return arguments.length?(f=e,f=f||"key",t):f},t.donut=function(e){return arguments.length?(p=e,t):p},t.donutRatio=function(e){return arguments.length?(A=e,t):A},t.startAngle=function(e){return arguments.length?(m=e,t):m},t.endAngle=function(e){return arguments.length?(b=e,t):b},t.id=function(e){return arguments.length?(u=e,t):u},t.color=function(e){return arguments.length?(o=nv.utils.getColor(e),t):o},t.valueFormat=function(e){return arguments.length?(s=e,t):s},t.labelThreshold=function(e){return arguments.length?(h=e,t):h},t};
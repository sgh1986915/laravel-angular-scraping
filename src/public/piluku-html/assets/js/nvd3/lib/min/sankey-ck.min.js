d3.sankey=function(){function n(){h.forEach(function(n){n.sourceLinks=[],n.targetLinks=[]}),d.forEach(function(n){var t=n.source,r=n.target;"number"==typeof t&&(t=n.source=h[n.source]),"number"==typeof r&&(r=n.target=h[n.target]),t.sourceLinks.push(n),r.targetLinks.push(n)})}function t(){h.forEach(function(n){n.value=Math.max(d3.sum(n.sourceLinks,f),d3.sum(n.targetLinks,f))})}function r(){for(var n,t=h,r=0;t.length;)n=[],t.forEach(function(t){t.x=r,t.dx=s,t.sourceLinks.forEach(function(t){n.push(t.target)})}),t=n,++r;u(r),e((g[0]-s)/(r-1))}function u(n){h.forEach(function(t){t.sourceLinks.length||(t.x=n-1)})}function e(n){h.forEach(function(t){t.x*=n})}function o(n){function t(){var n=d3.min(c,function(n){return(g[1]-(n.length-1)*y)/d3.sum(n,f)});c.forEach(function(t){t.forEach(function(t,r){t.y=r,t.dy=t.value*n})}),d.forEach(function(t){t.dy=t.value*n})}function r(n){function t(n){return i(n.source)*n.value}c.forEach(function(r){r.forEach(function(r){if(r.targetLinks.length){var u=d3.sum(r.targetLinks,t)/d3.sum(r.targetLinks,f);r.y+=(u-i(r))*n}})})}function u(n){function t(n){return i(n.target)*n.value}c.slice().reverse().forEach(function(r){r.forEach(function(r){if(r.sourceLinks.length){var u=d3.sum(r.sourceLinks,t)/d3.sum(r.sourceLinks,f);r.y+=(u-i(r))*n}})})}function e(){c.forEach(function(n){var t,r,u,e=0,c=n.length;for(n.sort(o),u=0;c>u;++u)t=n[u],r=e-t.y,r>0&&(t.y+=r),e=t.y+t.dy+y;if(r=e-y-g[1],r>0)for(e=t.y-=r,u=c-2;u>=0;--u)t=n[u],r=t.y+t.dy+y-e,r>0&&(t.y-=r),e=t.y})}function o(n,t){return n.y-t.y}var c=d3.nest().key(function(n){return n.x}).sortKeys(d3.ascending).entries(h).map(function(n){return n.values});t(),e();for(var a=1;n>0;--n)u(a*=.99),e(),r(a),e()}function c(){function n(n,t){return n.source.y-t.source.y}function t(n,t){return n.target.y-t.target.y}h.forEach(function(r){r.sourceLinks.sort(t),r.targetLinks.sort(n)}),h.forEach(function(n){var t=0,r=0;n.sourceLinks.forEach(function(n){n.sy=t,t+=n.dy}),n.targetLinks.forEach(function(n){n.ty=r,r+=n.dy})})}function i(n){return n.y+n.dy/2}function f(n){return n.value}var a={},s=24,y=8,g=[1,1],h=[],d=[];return a.nodeWidth=function(n){return arguments.length?(s=+n,a):s},a.nodePadding=function(n){return arguments.length?(y=+n,a):y},a.nodes=function(n){return arguments.length?(h=n,a):h},a.links=function(n){return arguments.length?(d=n,a):d},a.size=function(n){return arguments.length?(g=n,a):g},a.layout=function(u){return n(),t(),r(),o(u),c(),a},a.relayout=function(){return c(),a},a.link=function(){function n(n){var r=n.source.x+n.source.dx,u=n.target.x,e=d3.interpolateNumber(r,u),o=e(t),c=e(1-t),i=n.source.y+n.sy+n.dy/2,f=n.target.y+n.ty+n.dy/2;return"M"+r+","+i+"C"+o+","+i+" "+c+","+f+" "+u+","+f}var t=.5;return n.curvature=function(r){return arguments.length?(t=+r,n):t},n},a};